{
  "hash": "fe2aef9c9baababb9187c97f335be978",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise 02\"\norder: 2\nstatus: available\ndate-due: 2024-09-13\ndate-modified: last-modified\nerror: true\n---\n\n\n\n\n\n::: {.callout-tip collapse=\"false\" appearance=\"default\"}\n## Practice these skills\n\n-   Build a layered plot using `ggplot()`, `aes()`, and different `geom_` functions\n-   Explore the difference between discrete and continuous variables\n-   Use `coord_sf()` to modify a plot created with `geom_sf()`\n:::\n\n::: {.callout-note collapse=\"false\" appearance=\"default\"}\n## Think about these questions\n\n-   What makes a scale better or worse at visualizing data?\n-   How do you write a clear and accurate title, legend, or caption?\n-   When is it appropriate to modify the geometry of your data when making a map?\n:::\n\n## Setup\n\nThis exercises uses the `{ggplot2}` and `{dplyr}` packages (both from the [tidyverse family](https://www.tidyverse.org/) of packages) and the `{sf}` package:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(sf)\n```\n:::\n\n\n\n\n\nFor this week's exercise, we are also going to use data from the `{rnaturalearth}` package (which downloads data from the [Natural Earth data project](https://www.naturalearthdata.com/)) and the `{smoothr}` package that works with `sf` objects. If these packages are not installed already, make sure to install those packages and re-start your session:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npak::pkg_install(c(\"rnaturalearth\", \"rnaturalearthdata\", \"smoothr\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\n```\n:::\n\n\n\n\n\nWe are going to use `ne_download()` to download the `countries` dataset and then use `st_centroid()` to make a version of this dataset where the features show the center of each country instead of the boundaries:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Download data from Natural Earth\ncountries_ne <- ne_download(scale = \"medium\", type = \"countries\")\n\ncountries <- countries_ne |> \n  # Drop unused columns\n  select(\n    !starts_with(c(\"ISO\", \"ADM0\", \"FCLASS\", \"NAME\", \"MAPCOLOR\"))\n  ) |> \n  # Exclude Antarctica\n  filter(\n    SOVEREIGNT != \"Antarctica\"\n  ) |>\n  st_transform(crs = 3857)\n\ncountries_center <- st_centroid(countries)\n\nglimpse(countries)\n```\n:::\n\n\n\n\n\n## Exercises\n\n### Plotting a single variable\n\nFind a discrete variable in countries and then create a plot with `geom_bar()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_bar(mapping = aes(x = ____))\n```\n:::\n\n\n\n\n\nNext, find a continuous variable and make a plot with `geom_histogram()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_histogram(mapping = aes(x = ____))\n```\n:::\n\n\n\n\n\nNow, let's make a map! Use `countries_center` and `geom_sf()` to make a map with a continuous variable mapped to size:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries_center) +\n  geom_sf(aes(size = ____))\n```\n:::\n\n\n\n\n\n------------------------------------------------------------------------\n\nNext, make a map with `geom_sf()` with one discrete variable mapped to color:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_sf(aes(color = ____))\n```\n:::\n\n\n\n\n\nIs that the map you expected? Try it again with the discrete variable mapped to fill:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_sf(aes(fill = ____))\n```\n:::\n\n\n\n\n\nNow, try mapping the data using the same variable but use `facet_wrap()` to create a set of small maps for each region:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_sf(aes(fill = ____)) +\n  facet_wrap(~ ____)\n```\n:::\n\n\n\n\n\n------------------------------------------------------------------------\n\nNow, make a plot using any `geom` function of your choice:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  ____\n```\n:::\n\n\n\n\n\nExplain in plain language. What does your map or plot show? \\_\\_\\_\\_\n\n::: callout-tip\nRender, commit, and push your changes to GitHub with the commit message \"Added answers on plotting a single variable\".\n\nMake sure to commit and push all changed files so that your Git pane is empty afterwards.\n:::\n\n### Plotting two variables\n\nFor this next section, we are also going to use the `nc` data from the `{sf}` package since it has a larger number of continuous variables:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc <- read_sf(system.file(\"shape/nc.shp\", package = \"sf\"))\n```\n:::\n\n\n\n\n\nFirst, find two continuous variables and create a scatter plot with `geom_point()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = nc, mapping = aes(____)) +\n  geom_point()\n```\n:::\n\n\n\n\n\nNext, look in your data for one discrete and one continuous variable then use `aes()` to set those variables for `geom_col()`. The `geom_col()` function is similar to `geom_bar()` but you *must* provide *both* an x *and* a y variable:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = nc, mapping = aes(____)) +\n  geom_col()\n```\n:::\n\n\n\n\n\n### Using scales and colors\n\n`{ggplot2}` uses naming conventions to organize the scale functions. This isn't the same for every function but they look something like: \"scale\\_<aesthetic><color scheme><type of data>\". So, `scale_fill_viridis_d()` applies the Viridis color scale to a discrete variable mapped to the fill aesthetic.\n\nUse the data to create a map and take a look at the colors set when you use `scale_fill_viridis_c()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = nc) +\n  geom_sf(aes(fill = ____)) +\n  scale_fill_viridis_c()\n```\n:::\n\n\n\n\n\nThe [ColorBrewer](https://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3) scales are designed for use with [thematic maps](https://en.wikipedia.org/wiki/Thematic_map). Use `?scale_color_brewer()` to pull up the documentation for this function and review the information on the type and palette parameters.\n\nNow, map a variable to the `color` aesthetic for `geom_sf()` and assign an appropriate `type` and `palette` value:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries_center) +\n  geom_sf(aes(color = ____)) +\n  scale_color_brewer(type = ____, palette = ____)\n```\n:::\n\n\n\n\n\nSwitching from `color` to `fill`, try it again with a different type and palette value:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_sf(aes(fill = ____)) +\n  scale_fill_brewer(type = ____, palette = ____)\n```\n:::\n\n\n\n\n\nOne last time, but we're using `scale_fill_distiller()`. Note that this `scale_fill_distiller()` scale only works with continuous values. If you get an error, you may need to map a different variable to `fill`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = nc) +\n  geom_sf(aes(fill = ____)) +\n  scale_fill_distiller(type = ____, palette = ____)\n```\n:::\n\n\n\n\n\n### Adding labels, legends, and themes\n\nSet the data for `ggplot()` and then use the `labs()` function to apply a title and caption that make sense:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(color = \"black\", fill = NA) +\n  labs(\n    title = ____,\n    caption = ____\n  )\n```\n:::\n\n\n\n\n\nNow, map `fill` to a variable in your data using `aes()` and then use `labs()` to assign a label for fill:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(aes(fill = ____)) +\n  labs(\n    ____\n  )\n```\n:::\n\n\n\n\n\nFinally, put all of these elements together with a theme function. `theme_minimal()` and `theme_void()` are good themes to use for maps but you can explore [all of the options in the ggplot2 documentation](https://ggplot2.tidyverse.org/reference/ggtheme.html).\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(mapping = aes(____)) +\n  labs(\n    title = ____,\n    caption = ____,\n    ____\n  ) +\n  ____\n```\n:::\n\n\n\n\n\n::: callout-tip\nNow is another good time to render, commit, and push your changes to GitHub with a meaningful commit message.\n\nOnce again, make sure to commit and push all changed files so that your Git pane is empty afterwards.\n:::\n\n### Map making with `{ggplot2}`\n\nBy default, any map created with `geom_sf()` will show the graticulates on the map and axis labels with the coordinate values. You can also hide or change [graticules](https://en.wikipedia.org/wiki/Graticule_(cartography)) and axis title. Add data to this map and then hide these graticules by adding `theme_void()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(color = \"black\", fill = NA) +\n  ____\n```\n:::\n\n\n\n\n\nTry setting the `panel.grid` argument to `element_blank()` to hide the grid:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(color = \"black\", fill = NA) +\n  theme(\n    panel.grid = ____\n  )\n```\n:::\n\n\n\n\n\nRegardless of the selected theme, when you are using `geom_sf()`, you can also modify or suppress the graticule and axis labels using the `label_graticule` and `label_axes` parameters for `coord_sf()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = countries) +\n  geom_sf() +\n  coord_sf(\n    label_graticule = \"----\",\n    label_axes = \"----\"\n  ) +\n  theme_minimal()\n```\n:::\n\n\n\n\n\nNow, try \"zooming\" into a selected area of your map using the `xlim` and `ylim` arguments for `coord_sf()`:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ____) +\n  geom_sf(color = \"black\", fill = NA) +\n  coord_sf(\n    xlim = ____,\n    ylim = ____\n  )\n```\n:::\n\n\n\n\n\nIf you have difficulty with this one, look back at [our week 2 slides](https://bldgspatialdata.github.io/website/slides/data-visualization.html#/8/6) for an example showing how to use `sf::st_bbox()` to get xmin, xmax, ymin, and ymax values for the xlim and ylim parameter.\n\nThere are some cases when you need to modify the geometry of your data as part of the process of making a map. The `st_simplify()` function is one way to do that. Try setting dTolerance to a low value, e.g. `dTolerance = 10`, and run the code block. Then try to run it again with `dTolerance = 100000`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nusa <- filter(countries, NAME == \"United States of America\")\n\nsimple_usa <- st_simplify(x = usa, dTolerance = ____)\n\nggplot() +\n  geom_sf(\n    data = usa,\n    color = \"orange\"\n    ) +\n  geom_sf(\n    data = simple_usa,\n    color = \"purple\"\n  ) +\n  theme_void()\n```\n:::\n\n\n\n\n\nWhat happens when you increase the value of dTolerance? \\_\\_\\_\\_\n\nNow, let's try to same thing but smoothing features with `smoothr::smooth()` instead of simplifying with `sf::st_simplify()`. Start by setting smoothness to a small number, `smoothness = 0.5`, and then run again with higher and higher numbers:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmooth_usa <- smoothr::smooth(x = usa, method = \"ksmooth\", smoothness = ____)\n\nggplot() +\n  geom_sf(\n    data = usa,\n    color = \"orange\"\n    ) +\n  geom_sf(\n    data = smooth_usa,\n    color = \"purple\"\n  ) +\n  theme_void()\n```\n:::\n\n\n\n\n\nWhat happens when you increase the value of smoothness? \\_\\_\\_\\_\n\nCheck the documentation for `st_simplify()` or `smoothr::smooth()` for more information on how these functions work to modify the geometry. The [`rmapshaper::ms_simplify()`](https://andyteucher.ca/rmapshaper/reference/ms_simplify.html) is another function for the simplification of polygons in simple feature objects. In contrast to the other two examples, this function is topologically aware and preserves existing boundaries between contiguous polygons.\n\n### Optional: Creating maps with `{tmap}`\n\nPick one of the maps you created in the prior questions of this exercise and create a similar version using the `{tmap}` package.\n\nYou can install `{tmap}` the same as any other package:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# pak::pkg_install(\"tmap\")\n```\n:::\n\n\n\n\n\nThen load the library:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tmap)\n```\n:::\n\n\n\n\n\nAnd make a map using data from `{rnaturalearth}` or another source of your choice:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n____\n```\n:::\n\n\n\n\n\nWhat is the same about making a map with `{tmap}` compared to `{ggplot2}`? \\_\\_\\_\\_\n\nWhat is different about making a map with `{tmap}` compared to `{ggplot2}`? \\_\\_\\_\\_\n\nDo you have any preference between the two? \\_\\_\\_\\_\n\n::: callout-tip\nRender, commit, and push your final changes to GitHub with a meaningful commit message.\n\nMake sure to commit and push all changed files so that your Git pane is empty afterwards.\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}